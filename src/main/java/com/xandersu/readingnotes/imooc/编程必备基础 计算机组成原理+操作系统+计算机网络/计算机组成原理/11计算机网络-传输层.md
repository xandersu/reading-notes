# 11 è®¡ç®—æœºç½‘ç»œ-ä¼ è¾“å±‚

**ç®¡ç†ç«¯åˆ°ç«¯çš„é€šä¿¡è¿žæŽ¥** 

è¿›ç¨‹ä¸Žè¿›ç¨‹çš„é€šä¿¡ 

- UnixåŸŸå¥—æŽ¥å­— 
- å…±äº«å†…å­˜ 
- ç½‘ç»œé€šä¿¡ 

## **ä¼ è¾“å±‚æ¦‚è¿°** 

- ä½¿ç”¨ç«¯å£(Port)æ¥æ ‡è®°ä¸åŒçš„ç½‘ç»œè¿›ç¨‹ 
- ç«¯å£(Port)ä½¿ç”¨16æ¯”ç‰¹ä½è¡¨ç¤º(0~65535) 

| **FTP** | **HTTP** | **HTTPS** | **DNS** | **TELNET** |
| ------- | -------- | --------- | ------- | ---------- |
| 21      | 80       | 443       | 53      | 23    |



UDP ï¼šUDPåè®®

TCP ï¼šTCPåè®® ã€ä¸‰æ¬¡æ¡æ‰‹ã€å››æ¬¡é‡Šæ”¾ ã€TCPåè®®å¯é ä¼ è¾“ ã€TCPåè®®æµé‡æŽ§åˆ¶ã€TCPåè®®æ‹¥å¡žæŽ§åˆ¶ 



## UDPåè®® 

- UDP(User Datagram Protocol: ç”¨æˆ·æ•°æ®æŠ¥åè®®) 
- UDPæ˜¯ä¸€ä¸ªéžå¸¸ç®€å•çš„åè®® 

åº”ç”¨å±‚æ•°æ® 

UDPé¦–éƒ¨ | UDPæ•°æ®æŠ¥çš„æ•°æ® 

IPé¦–éƒ¨ | IPæ•°æ®æŠ¥çš„æ•°æ® 

IPæ•°æ®æŠ¥

å¸§é¦–éƒ¨ | å¸§â€çš„æ•°æ® | å¸§å°¾éƒ¨ 



16ä½æºç«¯å£å· | 16ä½ç›®çš„ç«¯å£å·
16ä½UDPé•¿åº¦ | 16ä½UDPæ ¡éªŒå’Œ
       UDPæ•°æ®

- UDPæ˜¯æ— è¿žæŽ¥åè®® 

- UDPä¸èƒ½ä¿è¯å¯é çš„äº¤ä»˜æ•°æ® ï¼ˆâ€œæƒ³å‘å°±å‘â€ï¼Œâ€œæ— æ³•ä¿è¯æ•°æ®åœ¨ç½‘ç»œä¸­æ˜¯å¦ä¸¢å¤±ï¼‰

- UDPæ˜¯é¢å‘æŠ¥æ–‡ä¼ è¾“çš„ ï¼ˆ
  åº”ç”¨å±‚æ•°æ® 
  UDPé¦–éƒ¨  |  UDPæ•°æ®æŠ¥çš„æ•°æ® 
  ï¼‰

- UDPæ²¡æœ‰æ‹¥å¡žæŽ§åˆ¶ 

- UDPçš„é¦–éƒ¨å¼€é”€å¾ˆå° 



## TCPåè®®

- TCP(Transmission Control Protocol: ä¼ è¾“æŽ§åˆ¶åè®®) 
- TCPåè®®æ˜¯è®¡ç®—æœºç½‘ç»œä¸­éžå¸¸å¤æ‚çš„ä¸€ä¸ªåè®® 

TCPé¦–éƒ¨ | TCPæ•°æ®æŠ¥çš„æ•°æ® 

IPé¦–éƒ¨ | IPæ•°æ®æŠ¥çš„æ•°æ® 

IPæ•°æ®æŠ¥

å¸§é¦–éƒ¨ | å¸§â€çš„æ•°æ® | å¸§å°¾éƒ¨ 

- TCPæ˜¯é¢å‘è¿žæŽ¥çš„åè®®
- TCPçš„ä¸€ä¸ªè¿žæŽ¥æœ‰ä¸¤ç«¯(ç‚¹å¯¹ç‚¹é€šä¿¡) 
-  TCPæä¾›å¯é çš„ä¼ è¾“æœåŠ¡ 
- TCPåè®®æä¾›å…¨åŒå·¥çš„é€šä¿¡ 
- TCPæ˜¯é¢å‘å­—èŠ‚æµçš„åè®® 

16ä½æºç«¯å£  |  16ä½ç›®çš„ç«¯å£
åºå·
ç¡®è®¤å·
æ•°æ®åç§»   |  ä¿ç•™å­—æ®µ  |  TCPæ ‡è®°  |  çª—å£
æ ¡éªŒå’Œ  |  ç´§æ€¥æŒ‡é’ˆ
TCPé€‰é¡¹(å¯é€‰)  |  å¡«å……

### **åºå·** 

- 0~2^32-1
- ä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªåºå· 
- æ•°æ®é¦–å­—èŠ‚åºå· 

### **ç¡®è®¤å·** 

- 0~2^32-1
- ä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªåºå·
- æœŸæœ›æ”¶åˆ°æ•°æ®çš„é¦–å­—èŠ‚åºå· 
- ç¡®è®¤å·ä¸ºN:åˆ™è¡¨ç¤ºN-1åºå·çš„æ•°æ®éƒ½å·²ç»æ”¶åˆ° 

### **æ•°æ®åç§»** 

- å 4ä½:0~15ï¼Œå•ä½ä¸º:32ä½å­— 
- æ•°æ®åç¦»é¦–éƒ¨çš„è·ç¦» 

### TCPæ ‡è®°

å 6ä½ï¼Œæ¯ä½å„æœ‰ä¸åŒæ„ä¹‰ 

| **æ ‡è®°** | **å«ä¹‰**                                        |
| -------- | ----------------------------------------------- |
| URG      | Urgent: ç´§æ€¥ä½ï¼ŒURG=1ï¼Œè¡¨ç¤ºç´§æ€¥æ•°æ®             |
| ACK      | Acknowledgement: ç¡®è®¤ä½ï¼ŒACK=1ï¼Œç¡®è®¤å·æ‰ç”Ÿæ•ˆ    |
| PSH      | Push: æŽ¨é€ä½ï¼ŒPSH=1ï¼Œå°½å¿«åœ°æŠŠæ•°æ®äº¤ä»˜ç»™åº”ç”¨å±‚   |
| RST      | Reset: é‡ç½®ä½ï¼ŒRST=1ï¼Œé‡æ–°å»ºç«‹è¿žæŽ¥              |
| SYN      | Synchronization: åŒæ­¥ä½ï¼ŒSYN=1 è¡¨ç¤ºè¿žæŽ¥è¯·æ±‚æŠ¥æ–‡ || FIN      | Finish: ç»ˆæ­¢ä½ï¼ŒFIN=1 è¡¨ç¤ºé‡Šæ”¾è¿žæŽ¥              |

### **çª—å£** 

-  å 16ä½:0~2^16-1
- çª—å£æŒ‡æ˜Žå…è®¸å¯¹æ–¹å‘é€çš„æ•°æ®é‡ 

### **æ ¡éªŒå’Œ** 

### **ç´§æ€¥æŒ‡é’ˆ** 

- ç´§æ€¥æ•°æ®(URG=1)
- æŒ‡å®šç´§æ€¥æ•°æ®åœ¨æŠ¥æ–‡çš„ä½ç½® 

### TCPé€‰é¡¹ 

- æœ€å¤š40å­—èŠ‚
- æ”¯æŒæœªæ¥çš„æ‹“å±• 

##**å¯é ä¼ è¾“çš„åŸºæœ¬åŽŸç†** 

- åœæ­¢ç­‰å¾…åè®® 
- è¿žç»­ARQåè®® 

###åœæ­¢ç­‰å¾…åè®® 

è¶…æ—¶é‡ä¼  

**å¯é ä¼ è¾“** 

- å‘é€çš„æ¶ˆæ¯åœ¨è·¯ä¸Šä¸¢å¤±äº† 
- ç¡®è®¤çš„æ¶ˆæ¯åœ¨è·¯ä¸Šä¸¢å¤±äº† 
- ç¡®è®¤çš„æ¶ˆæ¯å¾ˆä¹…æ‰åˆ° 

**è¶…æ—¶å®šæ—¶å™¨** 

æ¯å‘é€ä¸€ä¸ªæ¶ˆæ¯ï¼Œéƒ½éœ€è¦è®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨ 



- åœæ­¢ç­‰å¾…åè®®æ˜¯æœ€ç®€å•çš„å¯é ä¼ è¾“åè®® 
- åœæ­¢ç­‰å¾…åè®®å¯¹ä¿¡é“çš„åˆ©ç”¨æ•ˆçŽ‡ä¸é«˜ 

## è¿žç»­ARQåè®® 

- ARQ(Automatic Repeat reQuest:è‡ªåŠ¨é‡ä¼ è¯·æ±‚) 



## TCPåè®®çš„å¯é ä¼ è¾“

TCPçš„å¯é ä¼ è¾“åŸºäºŽè¿žç»­ARQåè®® 

TCPçš„æ»‘åŠ¨çª—å£ä»¥å­—èŠ‚ä¸ºå•ä½ 



## TCPåè®®çš„é€‰æ‹©é‡ä¼  

- é€‰æ‹©é‡ä¼ éœ€è¦æŒ‡å®šéœ€è¦é‡ä¼ çš„å­—èŠ‚ 
- æ¯ä¸€ä¸ªå­—èŠ‚éƒ½æœ‰å”¯ä¸€çš„32ä½åºå· 



## TCPåè®®çš„æµé‡æŽ§åˆ¶ 

- TCPåè®®ä½¿ç”¨æ»‘åŠ¨çª—å£å®žçŽ°æµé‡æŽ§åˆ¶ 
- åšæŒå®šæ—¶å™¨çš„ä½œç”¨ 

**çª—å£** 

- å 16ä½:0~2^16-1
- çª—å£æŒ‡æ˜Žå…è®¸å¯¹æ–¹å‘é€çš„æ•°æ® 

### **åšæŒå®šæ—¶å™¨** 

- å½“æŽ¥æ”¶åˆ°çª—å£ä¸º0çš„æ¶ˆæ¯ï¼Œåˆ™å¯åŠ¨åšæŒå®šæ—¶å™¨
- åšæŒå®šæ—¶å™¨æ¯éš”ä¸€æ®µæ—¶é—´å‘é€ä¸€ä¸ªçª—å£æŽ¢æµ‹æŠ¥æ–‡ 



## TCPåè®®çš„æ‹¥å¡žæŽ§åˆ¶ 

- ä¸€æ¡æ•°æ®é“¾è·¯ç»è¿‡éžå¸¸å¤šçš„è®¾å¤‡
- æ•°æ®é“¾è·¯ä¸­å„ä¸ªéƒ¨åˆ†éƒ½æœ‰å¯èƒ½æˆä¸ºç½‘è·¯ä¼ è¾“çš„ç“¶é¢ˆ 
- æµé‡æŽ§åˆ¶è€ƒè™‘ç‚¹å¯¹ç‚¹çš„é€šä¿¡é‡çš„æŽ§åˆ¶
- æ‹¥å¡žæŽ§åˆ¶è€ƒè™‘æ•´ä¸ªç½‘ç»œï¼Œæ˜¯å…¨å±€æ€§çš„è€ƒè™‘ 
- æŠ¥æ–‡è¶…æ—¶åˆ™è®¤ä¸ºæ˜¯æ‹¥å¡ž 

### **æ…¢å¯åŠ¨ç®—æ³•** 

- ç”±å°åˆ°å¤§é€æ¸å¢žåŠ å‘é€æ•°æ®é‡ 
- æ¯æ”¶åˆ°ä¸€ä¸ªæŠ¥æ–‡ç¡®è®¤ï¼Œå°±åŠ ä¸€ 
- ç»´æŠ¤ä¸€ä¸ªæ‹¥å¡žçª—å£çš„å˜é‡
- åªè¦ç½‘ç»œä¸æ‹¥å¡žï¼Œå°±è¯•æŽ¢ç€æ‹¥å¡žçª—å£è°ƒå¤§ 
- æ…¢å¯åŠ¨é˜ˆå€¼(ssthresh) 



##ä¸ºä»€ä¹ˆå‘é€æ–¹è¦å‘å‡ºç¬¬ä¸‰ä¸ªç¡®è®¤æŠ¥æ–‡å‘¢?

- å·²ç»å¤±æ•ˆçš„è¿žæŽ¥è¯·æ±‚æŠ¥æ–‡ä¼ é€åˆ°å¯¹æ–¹ï¼Œå¼•èµ·é”™è¯¯ 



## TCPè¿žæŽ¥çš„é‡Šæ”¾ 

2MSL 

- MSL(Max Segment Lifetime): æœ€é•¿æŠ¥æ–‡æ®µå¯¿å‘½ 
- MSLå»ºè®®è®¾ç½®ä¸º2åˆ†é’Ÿ 

### ä¸ºä»€ä¹ˆéœ€è¦ç­‰å¾…2MSL? 

- æœ€åŽä¸€ä¸ªæŠ¥æ–‡æ²¡æœ‰ç¡®è®¤ 
- ç¡®ä¿å‘é€æ–¹çš„ACKå¯ä»¥åˆ°è¾¾æŽ¥æ”¶æ–¹
- 2MSLæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°ï¼Œåˆ™æŽ¥æ”¶æ–¹ä¼šé‡å‘ 
- ç¡®ä¿å½“å‰è¿žæŽ¥çš„æ‰€æœ‰æŠ¥æ–‡éƒ½å·²ç»è¿‡æœŸ 



## **å¥—æŽ¥å­—ä¸Žå¥—æŽ¥å­—ç¼–ç¨‹** 

- ä½¿ç”¨ç«¯å£(Port)æ¥æ ‡è®°ä¸åŒçš„ç½‘ç»œè¿›ç¨‹ 
- ç«¯å£(Port)ä½¿ç”¨16æ¯”ç‰¹ä½è¡¨ç¤º(0~65535) 
- å¥—æŽ¥å­—(Socket)æ˜¯æŠ½è±¡æ¦‚å¿µï¼Œè¡¨ç¤ºTCPè¿žæŽ¥çš„ä¸€ç«¯ 
- é€šè¿‡å¥—æŽ¥å­—å¯ä»¥è¿›è¡Œæ•°æ®å‘é€æˆ–æŽ¥æ”¶ 
- TCPè¿žæŽ¥ç”±ä¸¤ä¸ªå¥—æŽ¥å­—ç»„æˆ :TCP= {ð‘†ð‘œð‘ð‘˜ð‘’ð‘¡1:ð‘†ð‘œð‘ð‘˜ð‘’ð‘¡2} = { {ð¼ð‘ƒ: ð‘ƒð‘œð‘Ÿð‘¡ ð¼ð‘ƒ: ð‘ƒð‘œð‘Ÿð‘¡ }  }



**åˆ›å»ºå¥—æŽ¥å­—** => **ç»‘å®š****(bind)****å¥—æŽ¥å­—**  => 



















