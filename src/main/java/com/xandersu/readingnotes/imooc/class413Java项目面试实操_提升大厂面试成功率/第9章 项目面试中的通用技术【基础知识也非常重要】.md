# 第9章 项目面试中的通用技术

## RBAC权限模型

- 基于角色的权限管理（Role-Based Access Control）

对象（资源）+ 操作（行为） = 权限

权限 <=> 角色 <=> 用户



高版本mysql支持json格式

##### t_role

|   字段名   | t_demo  |
| :--------: | :-----: |
|     id     |   int   |
|    role    | varchar |
| permission |  json   |



## 用shiro实现权限认证

- Apache基金会的开源安全框架，执行认证、授权和会话管理
- shiro比Spring Security更简单易用
- shiro和Spring MVC完美结合

浏览器 => shiroFilter(配置文件、配置类) => controller



## Oauth2验证

- 是一种开发授权标准，允许第三方应用获取用户的私有资源

  微信小程序 => 微信服务器。返回code有效期5分钟

  微信小程序 => renren-fast => 微信服务器。核对后返回openId（用户登录小程序的唯一标识，保存到数据库里作为用户名），生成token发给微信小程序。

  微信小程序存储token，每次调用renren-fast带着这个token，renren-fast验证token是否过期，到数据库里查这个tokenId有什么权限。

- Oauth2有四种验证方式



## 网站国际化

国际化是根据用户浏览器的语言和区域，显示不同的内容



- 单体WEB项目，国际化在SpringMVC上完成
- 前后端分离，在前端完成
- 移动端项目，在移动端完成

页面在哪里渲染，国际化就在哪里实现



## 如何防止重复提交

由于页面无响应，导致用户重新点击登陆按钮，重复提交表单。

简单的不严重的重复提交处理方法

- 没有响应之前，禁用前端页面的提交按钮
- 用户刷新页面和用URL提交请求，就能绕过重复提交
- 前端防止重复提交可以降低服务器负载



- 对于重要业务，可以使用token避免重复提交



## 系统缓存

- 后台缓存：数据库缓存、持久层缓存、业务层缓存
- 提升数据读写速度

### 数据库性能

- MySQL每秒处理5000次读取，或者3000次写入
- 响应时间通常在10ms以内，但在1万并发时，保证不了10ms相应速度

### 数据库缓存之查询缓存

- 如果开启查询缓存，数据库会把SELECT语句查询结果保存到缓存中

  query_cache_size = 2048M #缓存大小

  query_cache_type = ON #开启缓存

- 如果添加、修改和删除数据，会导致大量的缓存失效，增大IO负载，所以不建议开启查询缓存

### 持久层缓存

- Hibernate和MyBatis框架支持缓存，具体分一级缓存和二级缓存
- 一级缓存是会话缓存，session关闭，缓存失效
- 二级缓存是引入第三方存储机制缓存数据

### 二级缓存

- MyBatis支持：EHCache、Redis、Simple等

- Spring框架的Cache模块，可以管理MyBatis二级缓存

  cache.type=redis

  cache.cahe-names=student,dept #缓存数据起名字

- @Cacheable注解用来缓存数据 @Cacheable(value="student",key="#id")

- 在Service方法中使用二级缓存，不建议在Controller和DAO层中使用二级缓存

- 单条数据适合缓存，多条数据不适合缓存

- 单条数据的缓存相当于数据缓存，多条数据缓存相当于查询缓存



### 删除二级缓存

@CacheEvict(value="student",key = "#id")



### 业务层缓存

- 缓存一些业务数据
- 购物侧数据、头条新闻、秒杀商品缓存、公告通知
- 缓存持久化可以抵御系统重启之后刺穿缓存问题

## RDB两种持久化方案

- 默认RDB方案，以快照方式持久化，但不能实时保存数据，适合普通数据
- AOF模式把数据实时保存到硬盘上，适合重要数据持久化

### RDB

会在硬盘上生成dump.db文件

save 900 1		#900秒内有1条记录改变

save 300 10	  #300秒内有10条记录改变

save 60 10000  #60秒内有1万条记录改变

### AOF

在硬盘上生成appendonly.aof文件

appendonly yes #开起AOF

appendfsync always #缓存变化立即持久化



## 面试题

##### InnoDB缓存池用来缓存什么数据？

数据表和索引的一部分数据，也叫数据缓存。缓存设置越大，查询命中率越高。

##### MySQL还有一种查询缓存

这种缓存有大面积失效的情况



### XSS攻击

- XSS（跨站脚本）攻击，让浏览器渲染nDOM时意外执行了恶意JS代码
- XSS本质是在网页里嵌入恶意脚本
- 浏览器是沙箱环境，JS不可读写本地文件、不可连接数据库、不可以创建线程
- XSS不会对系统进行破坏，但可以盗用用户信息



## 项目测试

正规项目组，开发测试3：1或者4：1

敏捷开发的项目组，开发兼任测试工作

### 测试工具

| 序号 | 工具名称 |   范畴   |
| :--: | :------: | :------: |
|      |   禅道   | 测试管理 |
|      |  JUnit   | 单元测试 |
|      |  JMeter  | 性能测试 |
|      | Selenium | 前端测试 |
|      | Postman  | 接口测试 |

### 哪些测试方法

1. 等价类划分和边界值分析，业务清晰可采用场景地法设计用例，若业务之间有详细的因果关系，一开始要采用因果法。
2. 如果是文件配置类，考虑功能图发、错误推测法。



### 场景法

- 测试看成用户，模拟用户使用软件时的各种情景，进行测试工作
- 开始用例，基本流、备选流、结束用例
- 基本流：软件按照正确的事件流，中间无任何差错，从开始执行到结束的一条正确流程
- 备选流：软件功能在执行过程中，除了基本流之外遇到的各种情况，包含了可能存在问题的各个分支流

### 因果法

是一种利用图解法分析输入的各种组合情况，从而设计测试用例的方法，适合于检查程序输入条件的各种组合情况。



## HttpSession分布式存储

- 集群中，不能使用本地存储的HttpSession，会丢失数据
- 集群环境中，可以把HttpSession数据集中保存起来



- 引入redis
- 启动类加入@EnableRedisHttpSeesion注解



- 为了提高redis高负载、高性能、高可用，对Redis进行集群 Redis Cluster














