# 3-06 密集索引和稀疏索引的区别

## 索引模块

### 密集索引和稀疏索引的区别

- 密集索引文件中的每个搜索码值都对应一个索引值。
  - 叶子节点保存的不仅仅是键值，还保存了位于同一行记录里的其他列的信息，由于密集索引决定了物理表的排列顺序，一个表只能有一个物理排列顺序，所以一个表只能创建一个密集索引。
- 稀疏索引文件只为索引码的某些值建立索引项。
  - 叶子节点仅保存了键位信息以及该行数据的地址，有的稀疏索引仅保存了键位信息和主键，定位到叶子节点之后仍然需要通过地址或者主键信息进一步定位到数据。

## 额外的知识

- InnoDB 索引和数据存储在一块。有且仅有一个密集索引。xxx.ibd文件、xxx.frm文件。
- MyIsam 索引和数据分开。主键索引、唯一键索引、普通索引都是稀疏索引。xxx.MYI数据文件、xxx.MYD索引文件、xxx.frm文件。

### InnoDB

- 若一个主键被定义，该主键则作为密集索引
- 若没有主键被定义，该表的第一个唯一非空索引则作为密集索引
- 若不满足以上条件，InnoDB内部会生成一个隐藏主键（密集索引）。
  - 6字节的列，列的值会随着数据插入而自增。InnoDB必须有一个主键，该主键必须作为唯一的密集索引而存在。
- 非主键索引存储相关键位和其对应的主键值，包含两次查找。
  - 非主键索引（稀疏索引）的叶子节点并不存储行数据的物理地址，而是存储的是该行的主键值。
  - 非主键索引包含两次查找。一次是查找次级索引自身，然后再查找主键。



![JujsEt.png](https://s1.ax1x.com/2020/04/19/JujsEt.png)

sudo ls -lrth data/database_demo

