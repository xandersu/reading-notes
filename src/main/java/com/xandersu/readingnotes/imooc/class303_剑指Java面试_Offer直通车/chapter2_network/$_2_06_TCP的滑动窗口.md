# 2-06 TCP滑动窗口

## RTT和RTO

- RTT：发送一个数据包到收到对应的ACK，所花费的时间。发送一个数据包，对端回一个ACK，计算出发包到接到回应花费了多久。时间差。
- RTO：重传时间间隔。

## TCP的滑动窗口

### TCP使用滑动窗口做流量控制和乱序重排

- 保证TCP可靠性
- 提供TCP的流控特性

###窗口数据的计算过程

- AdvertisedWindow = MAxRcvBuffer - (LastByteRcvd - LastByteRead)
- EffectiveWindow = AdvertisedWindow - (LastByteSend - LastByteAcked)

### TCP会话的发送方

发送缓存里的数据分为4类：

1. 已经发送并且得到对端的回应的。
2. 已经发送还没收到对端的回应的。滑动窗口。
3. 未发送但对端允许发送的。滑动窗口。
4. 未发送且由于达到了window的大小，对端不允许发送的数据。

### TCP会话的接收方

接收缓存内数据存在3种状态：

1. 已接受并且已发送回执的状态。
2. 未接收但是可以接收。准备接收的状态。接收窗口。
3. 未接收，并且不能接受，因为达到了窗口的阈值。

最基本的可靠性来自确认重传机制。

发送窗口只有收到接收端对于本段发送窗口内的字节的ACK确认才会挪动发送窗口的左边界，接收窗口只有在前面所有的端都确认的情况下才会移动左边界，当在前面还有字节未接收但收到后面字节的情况下窗口不会移动，不对后续字节确认，以此确保对端会对这些数据进行重传。

滑动窗口的大小可以根据一定策略动态调整。

应用会通过自身处理能力的变化通过本端TCP接收窗口的大小控制来实现对端的发送窗口进行流量限制。