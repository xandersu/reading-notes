# 3-07 索引额外的问题之如何调优Sql

## 问题回顾和总结

- 为什么使用索引
    - 避免全表扫描查找数据，提升检索效率
- 什么样的信息能成为索引
    - 主键、唯一键等，具备区分性的数据
- 索引的数据结构
    - 主流B+树，还有哈希和bitmap，mysql不支持bitmap，基于innodb和MyIsam不显式支持hash
- 密集索引和稀疏索引的区别
    
## 索引模块

### 衍生的问题，mysql为例
- 如何定位并优化慢查询sql
- 联合索引的最左匹配原则的成因
- 索引是建立的越多越好吗

### 如何定位并优化慢查询sql

- 根据慢日志定位慢查询sql
- 使用explain等工具分析sql
- 修改sql或者尽量让sql走索引

#### 根据慢日志定位慢查询sql

show variables like '%quer%';
slow_query_log  OFF
slow_query_log_file /usr/local/mysql/data/xxx-slow.log
long_query_time 1.0000

show status like '%slow_queries%';
slow_queries    0

set global slow_query_log = on; --打开慢查询日志
set global long_query_time = 1; --设置慢查询时间1秒

explain select *  from XXX order by XXX

## Explain关键字段

- type
    - system>const>eq_ref>ref>fulltext>ref_or_null>index_merge>unique_subquery>index_subquery>range>index>all
    快到慢  index和all出现代表需要优化
- extra
    - 出现Using filesort和Using tempoaary代表mydql无法使用索引，影响效率。要优化
      1、 Using filesort    说明MySQL会对结果使用一个外部索引排序，而不是从表里按索引次序读到相关内容。可能在内存或者磁盘上排序。MySQL中无法利用索引完成的排序称为“文件排序”。
      2、 Using tempoaary     