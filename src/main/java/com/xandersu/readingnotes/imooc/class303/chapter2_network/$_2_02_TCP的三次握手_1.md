# 2-02 TCP的三次握手_1
## 说说tcp三次握手
### 传输控制协议TCP简介：

- 面向连接的、可靠的、基于字节流的传输层通信协议
- 将应用层的数据流分割成报文段并发送给目标节点的TCP层
- 数据包都有序号，对方收到则发送ACK确认，未收到则重传
- 使用校验和来校验数据在传输过程中是否有误

### TCP报文头

### TCP Flags

- URG：紧急指针标志
- ACK：确认序号标志
- PSH：push标志
- RST：重置连接标志
- SYN：同步序号，用于建立连接过程
- FIN：finish标志，用于释放标志

### "握手"是为了建立连接，TCP三次握手的流程图：

在Tcp/IP 协议中，TCP协议提供可靠的连接服务，采用三次握手建立一个连接。
第一次握手：建立连接时，客户端发送SYN包（syn=j）到服务器，并进入SYN_SEND状态，等待服务器确认。

第二次握手：服务器收到SYN包，必须确认客户的SYN（ack=j+1），同时自己也发送一个SYN包包（syn=k），即SYN+ACK包，此时服务器进入SYN_RECV状态。

第三次握手：客户端收到服务器的SYN+ACK包，向服务器发送确认包ACK（ack=ack+1），此包发送完毕，客户端和服务器进入ESTABLISHED状态，完成三次握手。

## 为什么需要三次握手才能创建连接

为了初始化Sequence Number的初始值

### 问题起因分析：

- Server收到SYN，恢复SYN-ACK的时候未收到ACK确认
- Server不断重试直至超时，Linux默认等待63秒才断开连接

### 针对SYN Flood的防护措施

- SYN队列满后，通过tcp_syncookies参数回发SYN Cookie
- 若为正常连接则Client会回发SYN Cookie，直接建立连接

## 建立连接后，Client出现故障怎么办
### 保活机制

- 向对方发送保活探测报文，如果未收到相应则继续发送
- 尝试次数达到保活探测数仍未收到相应则中断连接

